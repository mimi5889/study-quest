<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Çπ„Çø„Éá„Ç£„ÇØ„Ç®„Çπ„Éà - ‰∏≠Â≠¶Áîü„ÉÜ„Çπ„ÉàÂØæÁ≠ñ</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6B9D;
            --secondary: #FEC260;
            --accent: #9B59B6;
            --success: #2ECC71;
            --danger: #E74C3C;
            --bg-dark: #1A1A2E;
            --bg-light: #16213E;
            --text-light: #EAEAEA;
            --card-bg: #0F3460;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #16213E 50%, #0F3460 100%);
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 107, 157, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(254, 194, 96, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            padding: 30px 20px;
            animation: fadeInDown 0.8s ease-out;
        }

        h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(255, 107, 157, 0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--secondary);
            font-weight: 500;
        }

        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.8rem;
            box-shadow: 0 5px 20px rgba(255, 107, 157, 0.4);
            transition: all 0.3s ease;
            z-index: 100;
            border: none;
        }

        .settings-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 8px 30px rgba(255, 107, 157, 0.6);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.2) 0%, rgba(15, 52, 96, 0.6) 100%);
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
        }

        .stat-number {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--secondary);
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            opacity: 0.8;
            margin-top: 5px;
        }

        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
            animation: fadeInUp 0.8s ease-out 0.4s both;
        }

        .subject-card {
            background: rgba(15, 52, 96, 0.7);
            border: 2px solid transparent;
            border-radius: 25px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .subject-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .subject-card:hover::before {
            left: 100%;
        }

        .subject-card:hover {
            transform: scale(1.05) rotate(1deg);
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.3);
        }

        .subject-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .subject-name {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .quiz-container {
            background: rgba(15, 52, 96, 0.8);
            border: 2px solid var(--primary);
            border-radius: 30px;
            padding: 40px;
            margin: 30px 0;
            display: none;
            animation: scaleIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .quiz-container.active {
            display: block;
        }

        .question {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--secondary);
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 107, 157, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .option:hover::before {
            width: 300%;
            height: 300%;
        }

        .option:hover {
            border-color: var(--primary);
            transform: translateX(10px);
        }

        .option.selected {
            border-color: var(--secondary);
            background: rgba(254, 194, 96, 0.2);
        }

        .option.correct {
            border-color: var(--success);
            background: rgba(46, 204, 113, 0.2);
        }

        .option.wrong {
            border-color: var(--danger);
            background: rgba(231, 76, 60, 0.2);
        }

        .btn {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            z-index: -1;
        }

        .btn:hover::before {
            width: 300%;
            height: 300%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 5px 20px rgba(255, 107, 157, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 107, 157, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--primary);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .result-screen {
            text-align: center;
            padding: 40px;
            display: none;
            animation: scaleIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .result-screen.active {
            display: block;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
            font-family: 'Poppins', sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            color: white;
            box-shadow: 0 10px 40px rgba(255, 107, 157, 0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        .weakness-analysis {
            background: rgba(15, 52, 96, 0.6);
            border: 2px solid var(--danger);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: left;
        }

        .weakness-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--danger);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .weakness-item {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid var(--danger);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
        }

        /* Ë®≠ÂÆöÁîªÈù¢„ÅÆ„Çπ„Çø„Ç§„É´ */
        .settings-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 46, 0.95);
            z-index: 1000;
            display: none;
            overflow-y: auto;
            animation: fadeIn 0.3s ease-out;
        }

        .settings-screen.active {
            display: block;
        }

        .settings-content {
            max-width: 1000px;
            margin: 50px auto;
            padding: 40px;
            background: rgba(15, 52, 96, 0.9);
            border-radius: 30px;
            border: 2px solid var(--primary);
            position: relative;
        }

        .close-settings {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .close-settings:hover {
            background: var(--danger);
            border-color: var(--danger);
            transform: rotate(90deg);
        }

        .settings-header {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subject-settings {
            margin-bottom: 40px;
        }

        .subject-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.15) 0%, rgba(155, 89, 182, 0.15) 100%);
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-radius: 15px;
            margin-bottom: 15px;
        }

        .subject-header-icon {
            font-size: 2rem;
        }

        .subject-header-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary);
            flex: 1;
        }

        .select-all-btn {
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .select-all-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
            padding: 0;
            margin-bottom: 30px;
        }

        .topic-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .topic-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .topic-label {
            font-size: 0.95rem;
            color: var(--text-light);
            flex: 1;
        }

        .grade-badge {
            padding: 4px 12px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
            white-space: nowrap;
        }

        .topic-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--primary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .topic-checkbox.checked {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-color: var(--accent);
        }

        .topic-checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .save-settings-btn {
            display: block;
            margin: 40px auto 0;
            padding: 18px 60px;
            font-size: 1.2rem;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .particle {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--secondary);
            border-radius: 50%;
            pointer-events: none;
            animation: float 3s ease-in-out infinite;
            opacity: 0.6;
            z-index: 0;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
            }
            50% {
                transform: translateY(-20px) translateX(10px);
            }
        }

        /* „É¢„Éê„Ç§„É´ÂØæÂøú */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            .settings-btn {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }

            .subject-grid {
                grid-template-columns: 1fr;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .topics-grid {
                grid-template-columns: 1fr;
            }

            .settings-content {
                margin: 20px;
                padding: 20px;
            }

            .settings-header {
                font-size: 1.8rem;
            }

            .quick-select-bar {
                flex-direction: column;
            }

            .quick-btn {
                width: 100%;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .score-circle {
                width: 150px;
                height: 150px;
                font-size: 2.5rem;
            }
        }

        .quick-select-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
        }

        .quick-btn {
            padding: 12px 30px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>

    <div class="container">
        <header>
            <h1>üìö „Çπ„Çø„Éá„Ç£„ÇØ„Ç®„Çπ„Éà</h1>
            <p class="subtitle">Ê•Ω„Åó„ÅèÂ≠¶„Çì„Åß„ÄÅ„ÉÜ„Çπ„Éà„ÅßÈ´òÂæóÁÇπ„ÇíÁõÆÊåá„Åù„ÅÜ!</p>
        </header>

        <div id="homeScreen">
            <div class="stats-container">
                <div class="stat-card">
                    <span class="stat-number" id="totalQuestions">0</span>
                    <span class="stat-label">Ëß£„ÅÑ„ÅüÂïèÈ°åÊï∞</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="averageScore">0%</span>
                    <span class="stat-label">Âπ≥ÂùáÊ≠£Á≠îÁéá</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="studyStreak">0</span>
                    <span class="stat-label">ÈÄ£Á∂öÂ≠¶ÁøíÊó•Êï∞</span>
                </div>
            </div>

            <div class="subject-grid">
                <div class="subject-card" onclick="startQuiz('Êï∞Â≠¶')">
                    <span class="subject-icon">üî¢</span>
                    <div class="subject-name">Êï∞Â≠¶</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%"></div>
                    </div>
                    <p style="opacity: 0.7; margin-top: 10px;">Ê≠£Á≠îÁéá: 75%</p>
                </div>

                <div class="subject-card" onclick="startQuiz('Ëã±Ë™û')">
                    <span class="subject-icon">üåê</span>
                    <div class="subject-name">Ëã±Ë™û</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 68%"></div>
                    </div>
                    <p style="opacity: 0.7; margin-top: 10px;">Ê≠£Á≠îÁéá: 68%</p>
                </div>

                <div class="subject-card" onclick="startQuiz('ÁêÜÁßë')">
                    <span class="subject-icon">üî¨</span>
                    <div class="subject-name">ÁêÜÁßë</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 82%"></div>
                    </div>
                    <p style="opacity: 0.7; margin-top: 10px;">Ê≠£Á≠îÁéá: 82%</p>
                </div>

                <div class="subject-card" onclick="startQuiz('Á§æ‰ºö')">
                    <span class="subject-icon">üó∫Ô∏è</span>
                    <div class="subject-name">Á§æ‰ºö</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 70%"></div>
                    </div>
                    <p style="opacity: 0.7; margin-top: 10px;">Ê≠£Á≠îÁéá: 70%</p>
                </div>

                <div class="subject-card" onclick="startQuiz('ÂõΩË™û')">
                    <span class="subject-icon">üìñ</span>
                    <div class="subject-name">ÂõΩË™û</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 65%"></div>
                    </div>
                    <p style="opacity: 0.7; margin-top: 10px;">Ê≠£Á≠îÁéá: 65%</p>
                </div>

                <div class="subject-card" style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.3) 0%, rgba(155, 89, 182, 0.3) 100%); border: 2px solid var(--danger);" onclick="startReviewQuiz()">
                    <span class="subject-icon">‚ö†Ô∏è</span>
                    <div class="subject-name" style="color: var(--danger);">ÈñìÈÅï„Åà„ÅüÂïèÈ°å</div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--danger); margin: 15px 0;" id="wrongQuestionsCount">0</div>
                    <p style="opacity: 0.9; margin-top: 10px;">Âæ©Áøí„Åó„Å¶ÂÆåÁíß„Å´„Åó„Çà„ÅÜ!</p>
                </div>
            </div>
        </div>

        <div id="quizScreen" class="quiz-container">
            <h2 id="subjectTitle" style="font-family: 'Poppins', sans-serif; font-size: 2rem; margin-bottom: 10px;"></h2>
            <p style="opacity: 0.7; margin-bottom: 30px;">ÂïèÈ°å <span id="questionNumber">1</span> / <span id="totalQuestionsInQuiz">5</span></p>
            
            <div class="question" id="questionText"></div>
            
            <div class="options" id="optionsContainer"></div>

            <div class="button-group">
                <button class="btn btn-primary" id="submitBtn" onclick="checkAnswer()" disabled>ÂõûÁ≠î„Åô„Çã</button>
                <button class="btn btn-secondary" onclick="showHome()">Êàª„Çã</button>
            </div>
        </div>

        <div id="resultScreen" class="result-screen">
            <h2 style="font-family: 'Poppins', sans-serif; font-size: 2.5rem; margin-bottom: 20px;">üéâ „ÇØ„Ç§„Ç∫ÂÆå‰∫Ü!</h2>
            
            <div class="score-circle" id="finalScore">0%</div>
            
            <p style="font-size: 1.3rem; margin: 20px 0;">
                <span id="correctCount">0</span> / <span id="totalCount">5</span> ÂïèÊ≠£Ëß£
            </p>

            <div class="weakness-analysis" id="weaknessSection" style="display: none;">
                <div class="weakness-title">
                    <span>‚ö†Ô∏è</span>
                    <span>Ëã¶ÊâãÂàÜÈáé„ÅÆÂàÜÊûê</span>
                </div>
                <div id="weaknessContent"></div>
            </div>

            <div class="button-group" style="justify-content: center;">
                <button class="btn btn-primary" onclick="retryQuiz()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶</button>
                <button class="btn btn-secondary" onclick="showHome()">„Éõ„Éº„É†„Å´Êàª„Çã</button>
                <button class="btn btn-secondary" onclick="clearWrongAnswers()" id="clearWrongBtn" style="display: none;">ÈñìÈÅï„Åà„ÅüÂïèÈ°å„Çí„É™„Çª„ÉÉ„Éà</button>
            </div>
        </div>
    </div>

    <!-- Ë®≠ÂÆöÁîªÈù¢ -->
    <div id="settingsScreen" class="settings-screen">
        <div class="settings-content">
            <div class="close-settings" onclick="closeSettings()">√ó</div>
            <h2 class="settings-header">‚öôÔ∏è „ÉÜ„Çπ„ÉàÁØÑÂõ≤Ë®≠ÂÆö</h2>
            
            <div class="quick-select-bar">
                <button class="quick-btn" onclick="selectAllTopics()">üéØ „Åô„Åπ„Å¶ÈÅ∏Êäû</button>
                <button class="quick-btn" onclick="clearAllTopics()">üóëÔ∏è „Åô„Åπ„Å¶Ëß£Èô§</button>
                <button class="quick-btn" onclick="selectGrade1()">1Ô∏è‚É£ ‰∏≠1„ÅÆ„Åø</button>
                <button class="quick-btn" onclick="selectGrade2()">2Ô∏è‚É£ ‰∏≠2„ÅÆ„Åø</button>
                <button class="quick-btn" onclick="selectGrade3()">3Ô∏è‚É£ ‰∏≠3„ÅÆ„Åø</button>
                <button class="quick-btn" onclick="selectForExam()">üìö ÂÖ•Ë©¶ÂØæÁ≠ñ(ÂÖ®ÁØÑÂõ≤)</button>
            </div>

            <div id="settingsSubjects"></div>

            <button class="btn btn-primary save-settings-btn" onclick="saveSettings()">üíæ Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Å¶„ÇØ„Ç§„Ç∫„ÇíÂßã„ÇÅ„Çã</button>
        </div>
    </div>

    <script>
        // ‰∏≠Â≠¶Ê†°Â≠¶ÁøíË¶ÅÁ∂±„Å´Âü∫„Å•„ÅèÂçòÂÖÉ„Éá„Éº„Çø
        const curriculum = {
            'Êï∞Â≠¶': {
                1: ['Ê≠£„ÅÆÊï∞„ÉªË≤†„ÅÆÊï∞', 'ÊñáÂ≠óÂºè', '‰∏ÄÊ¨°ÊñπÁ®ãÂºè', 'ÊØî‰æã„Å®ÂèçÊØî‰æã', 'Âπ≥Èù¢Âõ≥ÂΩ¢', 'Á©∫ÈñìÂõ≥ÂΩ¢', '„Éá„Éº„Çø„ÅÆÊ¥ªÁî®'],
                2: ['Âºè„ÅÆË®àÁÆó', 'ÈÄ£Á´ãÊñπÁ®ãÂºè', '‰∏ÄÊ¨°Èñ¢Êï∞', 'Âõ≥ÂΩ¢„ÅÆÊÄßË≥™„Å®Ë®ºÊòé', '‰∏âËßíÂΩ¢„Å®ÂõõËßíÂΩ¢', 'Á¢∫Áéá'],
                3: ['Â§öÈ†ÖÂºè', 'Âπ≥ÊñπÊ†π', '‰∫åÊ¨°ÊñπÁ®ãÂºè', '‰∫åÊ¨°Èñ¢Êï∞', 'Áõ∏‰ºº„Å™Âõ≥ÂΩ¢', 'ÂÜÜ„ÅÆÊÄßË≥™', '‰∏âÂπ≥Êñπ„ÅÆÂÆöÁêÜ', 'Ê®ôÊú¨Ë™øÊüª']
            },
            'Ëã±Ë™û': {
                1: ['beÂãïË©û', '‰∏ÄËà¨ÂãïË©û', 'Ë§áÊï∞ÂΩ¢', 'ÂëΩ‰ª§Êñá', 'ÁñëÂïèË©û', 'ÁèæÂú®ÈÄ≤Ë°åÂΩ¢', 'Âä©ÂãïË©ûcan', 'ÈÅéÂéªÂΩ¢'],
                2: ['Êú™Êù•„ÅÆÊñá', 'Êé•Á∂öË©û', '‰∏çÂÆöË©û', 'ÂãïÂêçË©û', 'ÊØîËºÉ', 'ÂèóÂãïÊÖã', 'ÁèæÂú®ÂÆå‰∫Ü'],
                3: ['ÁèæÂú®ÂÆå‰∫ÜÈÄ≤Ë°åÂΩ¢', '‰∏çÂÆöË©û„ÅÆÂøúÁî®', 'ÂàÜË©û', 'Èñ¢‰øÇ‰ª£ÂêçË©û', '‰ªÆÂÆöÊ≥ï', 'ÈñìÊé•ÁñëÂïèÊñá']
            },
            'ÁêÜÁßë': {
                1: ['Ë∫´Ëøë„Å™ÁîüÁâ©', 'Ê§çÁâ©„ÅÆÂàÜÈ°û', 'Áâ©Ë≥™„ÅÆÊÄßË≥™', 'Ê∞ó‰Ωì„ÅÆÊÄßË≥™', 'Áä∂ÊÖãÂ§âÂåñ', 'ÂÖâ„ÅÆÊÄßË≥™', 'Èü≥„ÅÆÊÄßË≥™', 'Âäõ„Å®ÂúßÂäõ', 'Â§ßÂú∞„ÅÆÂ§âÂåñ'],
                2: ['ÂåñÂ≠¶Â§âÂåñ„Å®ÂéüÂ≠ê„ÉªÂàÜÂ≠ê', 'ÂåñÂ≠¶Â§âÂåñ„Å®Áâ©Ë≥™„ÅÆË≥™Èáè', 'ÁîüÁâ©„ÅÆ‰Ωì„ÅÆ„Å§„Åè„Çä', 'ÂãïÁâ©„ÅÆÂàÜÈ°û', 'ÈõªÊµÅ„Å®ÂõûË∑Ø', 'ÈõªÊµÅ„ÅÆÊ≠£‰Ωì', 'Á£ÅÁïå', 'Â§©Ê∞ó„Å®„Åù„ÅÆÂ§âÂåñ'],
                3: ['ÈÅãÂãï„Å®„Ç®„Éç„É´„ÇÆ„Éº', '‰ªï‰∫ã„Å®„Ç®„Éç„É´„ÇÆ„Éº', 'ÂåñÂ≠¶Â§âÂåñ„Å®„Ç§„Ç™„É≥', 'ÈÖ∏„Éª„Ç¢„É´„Ç´„É™', 'ÁîüÂëΩ„ÅÆÈÄ£Á∂öÊÄß', 'ÈÅ∫‰ºù„ÅÆË¶èÂâáÊÄß', 'Â§©‰Ωì„ÅÆÂãï„Åç', 'Êúà„Å®ÊÉëÊòü', 'Ëá™ÁÑ∂„Å®‰∫∫Èñì']
            },
            'Á§æ‰ºö': {
                1: ['‰∏ñÁïå„ÅÆÂßø', '„Ç¢„Ç∏„Ç¢', '„É®„Éº„É≠„ÉÉ„Éë', '„Ç¢„Éï„É™„Ç´', 'ÂçóÂåó„Ç¢„É°„É™„Ç´', '„Ç™„Çª„Ç¢„Éã„Ç¢', 'Âè§‰ª£ÊñáÊòé', 'Êó•Êú¨„ÅÆÊàê„ÇäÁ´ã„Å°', 'È£õÈ≥•ÊôÇ‰ª£', 'Â•àËâØÊôÇ‰ª£', 'Âπ≥ÂÆâÊôÇ‰ª£'],
                2: ['ÈéåÂÄâÊôÇ‰ª£', 'ÂÆ§Áî∫ÊôÇ‰ª£', 'ÂÆâÂúüÊ°ÉÂ±±ÊôÇ‰ª£', 'Ê±üÊà∏ÊôÇ‰ª£', 'ÊòéÊ≤ªÁ∂≠Êñ∞', 'Êó•Ê∏Ö„ÉªÊó•Èú≤Êà¶‰∫â', 'Á¨¨‰∏ÄÊ¨°‰∏ñÁïåÂ§ßÊà¶', '‰∏ñÁïåÊÅêÊÖå', 'Á¨¨‰∫åÊ¨°‰∏ñÁïåÂ§ßÊà¶', 'Êó•Êú¨ÂõΩÊÜ≤Ê≥ï', 'ÂÜ∑Êà¶'],
                3: ['Áèæ‰ª£„ÅÆÊó•Êú¨„Å®‰∏ñÁïå', '‰∫∫Ê®©„Å®Êó•Êú¨ÂõΩÊÜ≤Ê≥ï', 'Ê∞ë‰∏ªÊîøÊ≤ª', 'Âú∞ÊñπËá™Ê≤ª', 'ÁµåÊ∏à„ÅÆ„Åó„Åè„Åø', 'Ê∂àË≤ªÁîüÊ¥ª', 'ÁîüÁî£„Å®Âä¥ÂÉç', 'Ë≤°Êîø„Å®Á¶èÁ•â', 'ÂõΩÈöõÁ§æ‰ºö', 'Âú∞ÁêÉÁí∞Â¢ÉÂïèÈ°å']
            },
            'ÂõΩË™û': {
                1: ['Ë™¨ÊòéÁöÑÊñáÁ´†„ÅÆË™≠Ëß£', 'ÊñáÂ≠¶ÁöÑÊñáÁ´†„ÅÆË™≠Ëß£', 'Ë©©„ÅÆÈëëË≥û', 'Âè§ÂÖ∏ÂÖ•ÈñÄ', 'Êº¢Â≠ó„ÉªË™ûÂè•', 'ÊñáÊ≥ï(ÂìÅË©û)', '‰ΩúÊñá„ÉªË°®Áèæ'],
                2: ['Ë´ñË™¨Êñá„ÅÆË™≠Ëß£', 'Â∞èË™¨„ÅÆË™≠Ëß£', 'Áü≠Ê≠å„Éª‰ø≥Âè•', 'Âè§Êñá', 'Êº¢ÊñáÂÖ•ÈñÄ', 'ÊñáÊ≥ï(Ê¥ªÁî®)', 'Êï¨Ë™û', 'Ë©±„ÅóÂêà„ÅÑ„ÉªË®éË´ñ'],
                3: ['Ë©ïË´ñÊñá„ÅÆË™≠Ëß£', 'ÊñáÂ≠¶‰ΩúÂìÅ„ÅÆÈëëË≥û', 'ÂíåÊ≠å„Éª‰ø≥Ë´ß', 'Âè§ÂÖ∏ÊñáÂ≠¶', 'Êº¢Êñá', 'ÊñáÊ≥ï(Á∑èÂêà)', 'Â∞èË´ñÊñá', '„Éó„É¨„Çº„É≥„ÉÜ„Éº„Ç∑„Éß„É≥']
            }
        };

        // „ÇØ„Ç§„Ç∫„Éá„Éº„Çø„Éô„Éº„ÇπÔºàÂêÑÂçòÂÖÉ„Å´ÂØæÂøúÔºâ
        const quizDatabase = {
            'Êï∞Â≠¶': {
                'Ê≠£„ÅÆÊï∞„ÉªË≤†„ÅÆÊï∞': [
                    { question: '(-3) + (+5) „ÅÆË®àÁÆóÁµêÊûú„ÅØ?', options: ['-8', '-2', '+2', '+8'], correct: 2, topic: 'Ê≠£„ÅÆÊï∞„ÉªË≤†„ÅÆÊï∞' },
                    { question: '(-4) √ó (-2) „ÅÆË®àÁÆóÁµêÊûú„ÅØ?', options: ['-8', '-6', '+6', '+8'], correct: 3, topic: 'Ê≠£„ÅÆÊï∞„ÉªË≤†„ÅÆÊï∞' }
                ],
                '‰∏ÄÊ¨°ÊñπÁ®ãÂºè': [
                    { question: '2x + 5 = 13 „ÇíËß£„Åè„Å®?', options: ['x = 3', 'x = 4', 'x = 5', 'x = 6'], correct: 1, topic: '‰∏ÄÊ¨°ÊñπÁ®ãÂºè' },
                    { question: '3x - 7 = 2 „ÇíËß£„Åè„Å®?', options: ['x = 2', 'x = 3', 'x = 4', 'x = 5'], correct: 1, topic: '‰∏ÄÊ¨°ÊñπÁ®ãÂºè' }
                ],
                'Âπ≥Èù¢Âõ≥ÂΩ¢': [
                    { question: '‰∏âËßíÂΩ¢„ÅÆÂÜÖËßí„ÅÆÂíå„ÅØ?', options: ['90Â∫¶', '180Â∫¶', '270Â∫¶', '360Â∫¶'], correct: 1, topic: 'Âπ≥Èù¢Âõ≥ÂΩ¢' }
                ],
                'Âπ≥ÊñπÊ†π': [
                    { question: '‚àö16 „ÅÆÂÄ§„ÅØ?', options: ['2', '4', '8', '16'], correct: 1, topic: 'Âπ≥ÊñπÊ†π' }
                ],
                '‰∏ÄÊ¨°Èñ¢Êï∞': [
                    { question: 'y = 2x + 3 „ÅÆ„Ç∞„É©„Éï„ÅÆÂÇæ„Åç„ÅØ?', options: ['1', '2', '3', '4'], correct: 1, topic: '‰∏ÄÊ¨°Èñ¢Êï∞' }
                ]
            },
            'Ëã±Ë™û': {
                'beÂãïË©û': [
                    { question: 'Ê¨°„ÅÆÁ©∫Ê¨Ñ„Å´ÂÖ•„ÇãË™û„ÅØ? I ( ) a student.', options: ['am', 'is', 'are', 'be'], correct: 0, topic: 'beÂãïË©û' }
                ],
                '‰∏ÄËà¨ÂãïË©û': [
                    { question: 'Ê¨°„ÅÆÁ©∫Ê¨Ñ„Å´ÂÖ•„ÇãË™û„ÅØ? I ( ) to school every day.', options: ['go', 'goes', 'going', 'went'], correct: 0, topic: '‰∏ÄËà¨ÂãïË©û' }
                ],
                'ÈÅéÂéªÂΩ¢': [
                    { question: '"She plays tennis." „ÇíÈÅéÂéªÂΩ¢„Å´„Åô„Çã„Å®?', options: ['She play tennis.', 'She playing tennis.', 'She played tennis.', 'She has played tennis.'], correct: 2, topic: 'ÈÅéÂéªÂΩ¢' }
                ],
                'ÊØîËºÉ': [
                    { question: '"beautiful"„ÅÆÊØîËºÉÁ¥ö„ÅØ?', options: ['beautifuler', 'more beautiful', 'most beautiful', 'beautifulest'], correct: 1, topic: 'ÊØîËºÉ' }
                ],
                '‰∏çÂÆöË©û': [
                    { question: '"ÂΩº„ÅØÈáéÁêÉ„Åå‰∏äÊâã„Åß„Åô"„ÇíËã±Ë™û„Åß?', options: ['He is good at baseball.', 'He is good to baseball.', 'He is good for baseball.', 'He is good with baseball.'], correct: 0, topic: '‰∏çÂÆöË©û' }
                ]
            },
            'ÁêÜÁßë': {
                'Ê§çÁâ©„ÅÆÂàÜÈ°û': [
                    { question: 'ÂÖâÂêàÊàê„Å´ÂøÖË¶Å„Å™„ÇÇ„ÅÆ„ÅØ?', options: ['‰∫åÈÖ∏ÂåñÁÇ≠Á¥†', 'ÈÖ∏Á¥†', 'Á™íÁ¥†', '„É°„Çø„É≥'], correct: 0, topic: 'Ê§çÁâ©„ÅÆÂàÜÈ°û' }
                ],
                'ÂåñÂ≠¶Â§âÂåñ„Å®ÂéüÂ≠ê„ÉªÂàÜÂ≠ê': [
                    { question: 'Ê∞¥„ÅÆÂåñÂ≠¶Âºè„ÅØ?', options: ['H2O', 'CO2', 'O2', 'NaCl'], correct: 0, topic: 'ÂåñÂ≠¶Â§âÂåñ„Å®ÂéüÂ≠ê„ÉªÂàÜÂ≠ê' }
                ],
                'Â§©‰Ωì„ÅÆÂãï„Åç': [
                    { question: 'Âú∞ÁêÉ„Åã„ÇâÊúÄ„ÇÇËøë„ÅÑÊÉëÊòü„ÅØ?', options: ['ÁÅ´Êòü', 'ÈáëÊòü', 'Ê∞¥Êòü', 'Êú®Êòü'], correct: 1, topic: 'Â§©‰Ωì„ÅÆÂãï„Åç' }
                ],
                'ÈõªÊµÅ„Å®ÂõûË∑Ø': [
                    { question: 'ÈõªÊµÅ„ÅÆÂçò‰Ωç„ÅØ?', options: ['V („Éú„É´„Éà)', 'A („Ç¢„É≥„Éö„Ç¢)', 'Œ© („Ç™„Éº„É†)', 'W („ÉØ„ÉÉ„Éà)'], correct: 1, topic: 'ÈõªÊµÅ„Å®ÂõûË∑Ø' }
                ],
                'ÁîüÁâ©„ÅÆ‰Ωì„ÅÆ„Å§„Åè„Çä': [
                    { question: '‰∫∫Èñì„ÅÆÈ™®„ÅØ‰ΩïÊú¨?', options: ['Á¥Ñ100Êú¨', 'Á¥Ñ200Êú¨', 'Á¥Ñ300Êú¨', 'Á¥Ñ400Êú¨'], correct: 1, topic: 'ÁîüÁâ©„ÅÆ‰Ωì„ÅÆ„Å§„Åè„Çä' }
                ]
            },
            'Á§æ‰ºö': {
                '‰∏ñÁïå„ÅÆÂßø': [
                    { question: '‰∏ñÁïå„ÅßÊúÄ„ÇÇ‰∫∫Âè£„ÅÆÂ§ö„ÅÑÂõΩ„ÅØ?', options: ['„Ç¢„É°„É™„Ç´', '„Ç§„É≥„Éâ', '‰∏≠ÂõΩ', '„É≠„Ç∑„Ç¢'], correct: 1, topic: '‰∏ñÁïå„ÅÆÂßø' }
                ],
                'Êó•Êú¨„ÅÆÊàê„ÇäÁ´ã„Å°': [
                    { question: 'Êó•Êú¨„ÅÆÈ¶ñÈÉΩ„ÅØ?', options: ['Â§ßÈò™', '‰∫¨ÈÉΩ', 'Êù±‰∫¨', 'ÂêçÂè§Â±ã'], correct: 2, topic: 'Êó•Êú¨„ÅÆÊàê„ÇäÁ´ã„Å°' }
                ],
                'ÈéåÂÄâÊôÇ‰ª£': [
                    { question: 'ÈéåÂÄâÂπïÂ∫ú„ÇíÈñã„ÅÑ„Åü„ÅÆ„ÅØ?', options: ['Ê∫êÈ†ºÊúù', 'Ë∂≥Âà©Â∞äÊ∞è', 'Âæ≥Â∑ùÂÆ∂Â∫∑', 'ÁπîÁî∞‰ø°Èï∑'], correct: 0, topic: 'ÈéåÂÄâÊôÇ‰ª£' }
                ],
                'Ê∞ë‰∏ªÊîøÊ≤ª': [
                    { question: 'ÂõΩ‰ºö„ÅØ‰ΩïÈô¢Âà∂?', options: ['‰∏ÄÈô¢Âà∂', '‰∫åÈô¢Âà∂', '‰∏âÈô¢Âà∂', 'ÂõõÈô¢Âà∂'], correct: 1, topic: 'Ê∞ë‰∏ªÊîøÊ≤ª' }
                ],
                'Á¨¨‰∫åÊ¨°‰∏ñÁïåÂ§ßÊà¶': [
                    { question: 'Á¨¨‰∫åÊ¨°‰∏ñÁïåÂ§ßÊà¶„ÅåÁµÇ„Çè„Å£„ÅüÂπ¥„ÅØ?', options: ['1943Âπ¥', '1944Âπ¥', '1945Âπ¥', '1946Âπ¥'], correct: 2, topic: 'Á¨¨‰∫åÊ¨°‰∏ñÁïåÂ§ßÊà¶' }
                ]
            },
            'ÂõΩË™û': {
                'ÊñáÂ≠¶ÁöÑÊñáÁ´†„ÅÆË™≠Ëß£': [
                    { question: '„ÄåÂ±±ÊúàË®ò„Äç„ÅÆ‰ΩúËÄÖ„ÅØ?', options: ['Â§èÁõÆÊº±Áü≥', 'Ëä•Â∑ùÈæç‰πã‰ªã', '‰∏≠Â≥∂Êï¶', 'Â§™ÂÆ∞Ê≤ª'], correct: 2, topic: 'ÊñáÂ≠¶ÁöÑÊñáÁ´†„ÅÆË™≠Ëß£' }
                ],
                'Êº¢Â≠ó„ÉªË™ûÂè•': [
                    { question: 'Ê¨°„ÅÆÊº¢Â≠ó„ÅÆË™≠„ÅøÊñπ„ÅØ? „ÄåÊÜÇÈ¨±„Äç', options: ['„ÇÜ„ÅÜ„ÅÜ„Å§', '„ÇÜ„ÅÜ„Å§', '„ÅÜ„ÇÜ„Å§', '„ÇÜ„ÅÜ„ÅÜ„Å°'], correct: 0, topic: 'Êº¢Â≠ó„ÉªË™ûÂè•' }
                ],
                'Áü≠Ê≠å„Éª‰ø≥Âè•': [
                    { question: '‰ø≥Âè•„ÅØ‰ΩïÈü≥„ÅßÊßãÊàê„Åï„Çå„Çã?', options: ['12Èü≥', '14Èü≥', '17Èü≥', '20Èü≥'], correct: 2, topic: 'Áü≠Ê≠å„Éª‰ø≥Âè•' }
                ],
                'ÊñáÊ≥ï(Ê¥ªÁî®)': [
                    { question: '„ÄåËµ∞„Çã„Äç„ÅÆÊú™ÁÑ∂ÂΩ¢„ÅØ?', options: ['Ëµ∞„Çâ', 'Ëµ∞„Çä', 'Ëµ∞„Çã', 'Ëµ∞„Çå'], correct: 0, topic: 'ÊñáÊ≥ï(Ê¥ªÁî®)' }
                ],
                'ÊñáÂ≠¶ÁöÑÊñáÁ´†„ÅÆË™≠Ëß£': [
                    { question: '„ÄåÁå´„Çí„Åã„Å∂„Çã„Äç„ÅÆÊÑèÂë≥„ÅØ?', options: ['Êú¨ÊÄß„ÇíÈö†„Åó„Å¶„Åä„Å®„Å™„Åó„ÅèÊåØ„ÇãËàû„ÅÜ', 'Áå´„ÇíÂ§ßÂàá„Å´„Åô„Çã', 'ÂØí„Åï„Å´ËÄê„Åà„Çã', 'ÁßòÂØÜ„ÇíÂÆà„Çã'], correct: 0, topic: 'ÊñáÂ≠¶ÁöÑÊñáÁ´†„ÅÆË™≠Ëß£' }
                ]
            }
        };

        let selectedTopics = {};
        let currentSubject = '';
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let score = 0;
        let wrongAnswers = [];
        let allWrongAnswers = []; // ÂÖ®„Å¶„ÅÆÈñìÈÅï„Åà„ÅüÂïèÈ°å„Çí‰øùÂ≠ò
        let isReviewMode = false; // Âæ©Áøí„É¢„Éº„Éâ„Åã„Å©„ÅÜ„Åã
        let stats = {
            totalQuestions: 0,
            totalCorrect: 0,
            studyStreak: 0
        };

        // ÂàùÊúüÂåñ: „Åô„Åπ„Å¶„ÅÆÂçòÂÖÉ„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„Çã
        function initializeSettings() {
            selectedTopics = {};
            for (let subject in curriculum) {
                selectedTopics[subject] = {};
                for (let grade in curriculum[subject]) {
                    selectedTopics[subject][grade] = [...curriculum[subject][grade]];
                }
            }
            // LocalStorage„Åã„ÇâË®≠ÂÆö„ÇíË™≠„ÅøËæº„ÇÄ
            const saved = localStorage.getItem('studyQuestSettings');
            if (saved) {
                try {
                    selectedTopics = JSON.parse(saved);
                } catch (e) {
                    console.error('Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', e);
                }
            }
            
            // ÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÇíË™≠„ÅøËæº„ÇÄ
            const savedWrong = localStorage.getItem('studyQuestWrongAnswers');
            if (savedWrong) {
                try {
                    allWrongAnswers = JSON.parse(savedWrong);
                    updateWrongAnswersCount();
                } catch (e) {
                    console.error('ÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', e);
                }
            }
        }

        function updateWrongAnswersCount() {
            const count = allWrongAnswers.length;
            const countElement = document.getElementById('wrongQuestionsCount');
            if (countElement) {
                countElement.textContent = count;
            }
        }

        function saveWrongAnswers() {
            try {
                localStorage.setItem('studyQuestWrongAnswers', JSON.stringify(allWrongAnswers));
                updateWrongAnswersCount();
            } catch (e) {
                console.error('ÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', e);
            }
        }

        function startReviewQuiz() {
            if (allWrongAnswers.length === 0) {
                alert('„Åæ„Å†ÈñìÈÅï„Åà„ÅüÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ\nÂÖà„Å´„ÇØ„Ç§„Ç∫„Å´ÊåëÊà¶„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ');
                return;
            }

            isReviewMode = true;
            currentSubject = 'Âæ©Áøí„É¢„Éº„Éâ';
            
            // ÈñìÈÅï„Åà„ÅüÂïèÈ°å„Çí„Ç∑„É£„ÉÉ„Éï„É´
            const shuffled = [...allWrongAnswers].sort(() => 0.5 - Math.random());
            window.currentQuestions = shuffled.slice(0, Math.min(10, shuffled.length));
            
            currentQuestionIndex = 0;
            selectedAnswer = null;
            score = 0;
            wrongAnswers = [];

            document.getElementById('homeScreen').style.display = 'none';
            document.getElementById('quizScreen').classList.add('active');
            document.getElementById('resultScreen').classList.remove('active');
            
            document.getElementById('subjectTitle').textContent = '‚ö†Ô∏è ÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÅÆÂæ©Áøí';
            document.getElementById('totalQuestionsInQuiz').textContent = window.currentQuestions.length;
            
            loadQuestion();
        }

        function openSettings() {
            document.getElementById('settingsScreen').classList.add('active');
            renderSettings();
        }

        function closeSettings() {
            document.getElementById('settingsScreen').classList.remove('active');
        }

        function renderSettings() {
            const container = document.getElementById('settingsSubjects');
            container.innerHTML = '';

            const subjects = {
                'Êï∞Â≠¶': 'üî¢',
                'Ëã±Ë™û': 'üåê',
                'ÁêÜÁßë': 'üî¨',
                'Á§æ‰ºö': 'üó∫Ô∏è',
                'ÂõΩË™û': 'üìñ'
            };

            for (let subject in subjects) {
                const subjectDiv = document.createElement('div');
                subjectDiv.className = 'subject-settings';

                // ÂÖ®Â≠¶Âπ¥„ÅÆÂçòÂÖÉ„Çí‰∏Ä„Å§„ÅÆ„É™„Çπ„Éà„Å´
                let allTopicsHTML = '';
                for (let grade = 1; grade <= 3; grade++) {
                    const topics = curriculum[subject][grade] || [];
                    topics.forEach(topic => {
                        const isChecked = isTopicSelected(subject, grade, topic);
                        const checkId = `check-${subject}-${grade}-${topic.replace(/[„Éª\s]/g, '_')}`;
                        allTopicsHTML += `
                            <div class="topic-item" onclick="toggleTopic('${subject}', ${grade}, '${topic.replace(/'/g, "\\'")}')">
                                <div class="topic-checkbox ${isChecked ? 'checked' : ''}" id="${checkId}"></div>
                                <div class="topic-label">${topic}</div>
                                <div class="grade-badge">‰∏≠${grade}</div>
                            </div>
                        `;
                    });
                }

                subjectDiv.innerHTML = `
                    <div class="subject-header">
                        <span class="subject-header-icon">${subjects[subject]}</span>
                        <span class="subject-header-title">${subject}</span>
                        <button class="select-all-btn" onclick="event.stopPropagation(); toggleAllSubject('${subject}')">
                            „Åô„Åπ„Å¶ÈÅ∏Êäû/Ëß£Èô§
                        </button>
                    </div>
                    <div class="topics-grid">
                        ${allTopicsHTML}
                    </div>
                `;

                container.appendChild(subjectDiv);
            }
        }

        function isTopicSelected(subject, grade, topic) {
            return selectedTopics[subject] && 
                   selectedTopics[subject][grade] && 
                   selectedTopics[subject][grade].includes(topic);
        }

        function toggleTopic(subject, grade, topic) {
            if (!selectedTopics[subject]) selectedTopics[subject] = {};
            if (!selectedTopics[subject][grade]) selectedTopics[subject][grade] = [];

            const index = selectedTopics[subject][grade].indexOf(topic);
            if (index > -1) {
                selectedTopics[subject][grade].splice(index, 1);
            } else {
                selectedTopics[subject][grade].push(topic);
            }

            const checkboxId = `check-${subject}-${grade}-${topic.replace(/[„Éª\s]/g, '_')}`;
            const checkbox = document.getElementById(checkboxId);
            if (checkbox) {
                checkbox.classList.toggle('checked');
            }
        }

        function toggleAllSubject(subject) {
            const allSelected = isSubjectAllSelected(subject);
            
            for (let grade = 1; grade <= 3; grade++) {
                const topics = curriculum[subject][grade] || [];
                if (!selectedTopics[subject]) selectedTopics[subject] = {};
                
                if (allSelected) {
                    selectedTopics[subject][grade] = [];
                } else {
                    selectedTopics[subject][grade] = [...topics];
                }
            }
            
            renderSettings();
        }

        function isSubjectAllSelected(subject) {
            for (let grade = 1; grade <= 3; grade++) {
                const topics = curriculum[subject][grade] || [];
                if (!topics.every(topic => isTopicSelected(subject, grade, topic))) {
                    return false;
                }
            }
            return true;
        }

        function selectAllTopics() {
            for (let subject in curriculum) {
                for (let grade in curriculum[subject]) {
                    selectedTopics[subject] = selectedTopics[subject] || {};
                    selectedTopics[subject][grade] = [...curriculum[subject][grade]];
                }
            }
            renderSettings();
        }

        function clearAllTopics() {
            for (let subject in curriculum) {
                selectedTopics[subject] = {};
                for (let grade in curriculum[subject]) {
                    selectedTopics[subject][grade] = [];
                }
            }
            renderSettings();
        }

        function selectGrade1() {
            clearAllTopics();
            for (let subject in curriculum) {
                if (curriculum[subject][1]) {
                    selectedTopics[subject] = selectedTopics[subject] || {};
                    selectedTopics[subject][1] = [...curriculum[subject][1]];
                }
            }
            renderSettings();
        }

        function selectGrade2() {
            clearAllTopics();
            for (let subject in curriculum) {
                if (curriculum[subject][2]) {
                    selectedTopics[subject] = selectedTopics[subject] || {};
                    selectedTopics[subject][2] = [...curriculum[subject][2]];
                }
            }
            renderSettings();
        }

        function selectGrade3() {
            clearAllTopics();
            for (let subject in curriculum) {
                if (curriculum[subject][3]) {
                    selectedTopics[subject] = selectedTopics[subject] || {};
                    selectedTopics[subject][3] = [...curriculum[subject][3]];
                }
            }
            renderSettings();
        }

        function selectForExam() {
            selectAllTopics();
        }

        function saveSettings() {
            // LocalStorage„Å´‰øùÂ≠ò
            try {
                localStorage.setItem('studyQuestSettings', JSON.stringify(selectedTopics));
                closeSettings();
                
                // ÈÅ∏Êäû„Åï„Çå„ÅüÈ†ÖÁõÆÊï∞„ÇíË®àÁÆó
                let totalSelected = 0;
                for (let subject in selectedTopics) {
                    for (let grade in selectedTopics[subject]) {
                        totalSelected += selectedTopics[subject][grade].length;
                    }
                }
                
                alert(`‚úÖ Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ\n${totalSelected}ÂÄã„ÅÆÂçòÂÖÉ„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`);
            } catch (e) {
                alert('‚ö†Ô∏è Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                console.error('‰øùÂ≠ò„Ç®„É©„Éº:', e);
            }
        }

        function getQuestionsForSubject(subject) {
            const questions = [];
            const subjectTopics = selectedTopics[subject];
            
            if (!subjectTopics) return [];

            for (let grade in subjectTopics) {
                const topics = subjectTopics[grade];
                topics.forEach(topic => {
                    if (quizDatabase[subject] && quizDatabase[subject][topic]) {
                        questions.push(...quizDatabase[subject][topic]);
                    }
                });
            }

            // „É©„É≥„ÉÄ„É†„Å´5ÂïèÈÅ∏Êäû
            const shuffled = questions.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, Math.min(5, shuffled.length));
        }

        function createParticles() {
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 3 + 's';
                particle.style.animationDuration = (3 + Math.random() * 2) + 's';
                document.body.appendChild(particle);
            }
        }

        function startQuiz(subject) {
            isReviewMode = false; // ÈÄöÂ∏∏„É¢„Éº„Éâ„Å´Êàª„Åô
            currentSubject = subject;
            const questions = getQuestionsForSubject(subject);
            
            if (questions.length === 0) {
                alert('ÈÅ∏Êäû„Åó„ÅüÁØÑÂõ≤„Å´ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇË®≠ÂÆöÁîªÈù¢„ÅßÁØÑÂõ≤„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                openSettings();
                return;
            }

            window.currentQuestions = questions;
            currentQuestionIndex = 0;
            selectedAnswer = null;
            score = 0;
            wrongAnswers = [];

            document.getElementById('homeScreen').style.display = 'none';
            document.getElementById('quizScreen').classList.add('active');
            document.getElementById('resultScreen').classList.remove('active');
            
            document.getElementById('subjectTitle').textContent = subject + ' „ÇØ„Ç§„Ç∫';
            document.getElementById('totalQuestionsInQuiz').textContent = questions.length;
            
            loadQuestion();
        }

        function loadQuestion() {
            const questions = window.currentQuestions;
            const currentQuestion = questions[currentQuestionIndex];
            
            document.getElementById('questionNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = currentQuestion.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            currentQuestion.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            selectedAnswer = null;
            document.getElementById('submitBtn').disabled = true;
        }

        function selectOption(index) {
            selectedAnswer = index;
            
            const options = document.querySelectorAll('.option');
            options.forEach((option, i) => {
                option.classList.remove('selected');
                if (i === index) {
                    option.classList.add('selected');
                }
            });
            
            document.getElementById('submitBtn').disabled = false;
        }

        function checkAnswer() {
            const questions = window.currentQuestions;
            const currentQuestion = questions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            options[currentQuestion.correct].classList.add('correct');
            
            if (selectedAnswer === currentQuestion.correct) {
                score++;
                
                // Âæ©Áøí„É¢„Éº„Éâ„ÅßÊ≠£Ëß£„Åó„ÅüÂ†¥Âêà„ÄÅÈñìÈÅï„Åà„ÅüÂïèÈ°å„É™„Çπ„Éà„Åã„ÇâÂâäÈô§
                if (isReviewMode) {
                    const index = allWrongAnswers.findIndex(q => 
                        q.question === currentQuestion.question && 
                        q.topic === currentQuestion.topic
                    );
                    if (index > -1) {
                        allWrongAnswers.splice(index, 1);
                        saveWrongAnswers();
                    }
                }
            } else {
                options[selectedAnswer].classList.add('wrong');
                wrongAnswers.push({
                    question: currentQuestion.question,
                    topic: currentQuestion.topic,
                    yourAnswer: currentQuestion.options[selectedAnswer],
                    correctAnswer: currentQuestion.options[currentQuestion.correct]
                });
                
                // ÈÄöÂ∏∏„É¢„Éº„Éâ„ÅßÈñìÈÅï„Åà„ÅüÂ†¥Âêà„ÄÅÈñìÈÅï„Åà„ÅüÂïèÈ°å„É™„Çπ„Éà„Å´ËøΩÂä†ÔºàÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØÔºâ
                if (!isReviewMode) {
                    const exists = allWrongAnswers.some(q => 
                        q.question === currentQuestion.question && 
                        q.topic === currentQuestion.topic
                    );
                    if (!exists) {
                        allWrongAnswers.push({
                            question: currentQuestion.question,
                            options: currentQuestion.options,
                            correct: currentQuestion.correct,
                            topic: currentQuestion.topic
                        });
                        saveWrongAnswers();
                    }
                }
            }
            
            stats.totalQuestions++;
            if (selectedAnswer === currentQuestion.correct) {
                stats.totalCorrect++;
            }
            
            setTimeout(() => {
                currentQuestionIndex++;
                
                if (currentQuestionIndex < questions.length) {
                    loadQuestion();
                } else {
                    showResults();
                }
            }, 1500);
        }

        function showResults() {
            document.getElementById('quizScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.add('active');
            
            const questions = window.currentQuestions;
            const percentage = Math.round((score / questions.length) * 100);
            document.getElementById('finalScore').textContent = percentage + '%';
            document.getElementById('correctCount').textContent = score;
            document.getElementById('totalCount').textContent = questions.length;
            
            updateStats();
            
            // Âæ©Áøí„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÄÅ„ÇØ„É™„Ç¢„Éú„Çø„É≥„ÇíË°®Á§∫
            const clearBtn = document.getElementById('clearWrongBtn');
            if (clearBtn) {
                clearBtn.style.display = isReviewMode ? 'block' : 'none';
            }
            
            if (wrongAnswers.length > 0) {
                document.getElementById('weaknessSection').style.display = 'block';
                const weaknessContent = document.getElementById('weaknessContent');
                weaknessContent.innerHTML = '';
                
                wrongAnswers.forEach(wa => {
                    const item = document.createElement('div');
                    item.className = 'weakness-item';
                    item.innerHTML = `
                        <strong>ÂàÜÈáé: ${wa.topic}</strong><br>
                        <p style="margin-top: 8px; opacity: 0.9;">ÂïèÈ°å: ${wa.question}</p>
                        <p style="margin-top: 5px; color: var(--danger);">„ÅÇ„Å™„Åü„ÅÆÂõûÁ≠î: ${wa.yourAnswer}</p>
                        <p style="margin-top: 5px; color: var(--success);">Ê≠£Ëß£: ${wa.correctAnswer}</p>
                    `;
                    weaknessContent.appendChild(item);
                });
            } else {
                document.getElementById('weaknessSection').style.display = 'none';
            }
            
            // Âæ©Áøí„É¢„Éº„Éâ„ÅßÂÖ®ÂïèÊ≠£Ëß£„ÅÆÂ†¥Âêà
            if (isReviewMode && wrongAnswers.length === 0 && score === questions.length) {
                setTimeout(() => {
                    alert('üéâ Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅÂæ©ÁøíÂïèÈ°å„ÇíÂÖ®ÂïèÊ≠£Ëß£„Åó„Åæ„Åó„ÅüÔºÅ\nÈñìÈÅï„Åà„ÅüÂïèÈ°å„É™„Çπ„Éà„Åã„ÇâÂâäÈô§„Åï„Çå„Åæ„Åó„Åü„ÄÇ');
                }, 500);
            }
        }

        function clearWrongAnswers() {
            if (confirm('ÈñìÈÅï„Åà„ÅüÂïèÈ°å„Çí„Åô„Åπ„Å¶„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                allWrongAnswers = [];
                saveWrongAnswers();
                alert('‚úÖ ÈñìÈÅï„Åà„ÅüÂïèÈ°å„É™„Çπ„Éà„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„ÅüÔºÅ');
                showHome();
            }
        }

        function updateStats() {
            document.getElementById('totalQuestions').textContent = stats.totalQuestions;
            const avgScore = stats.totalQuestions > 0 ? 
                Math.round((stats.totalCorrect / stats.totalQuestions) * 100) : 0;
            document.getElementById('averageScore').textContent = avgScore + '%';
        }

        function retryQuiz() {
            if (isReviewMode) {
                startReviewQuiz();
            } else {
                startQuiz(currentSubject);
            }
        }

        function showHome() {
            document.getElementById('homeScreen').style.display = 'block';
            document.getElementById('quizScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.remove('active');
        }

        // ÂàùÊúüÂåñ
        initializeSettings();
        createParticles();
        updateStats();
    </script>
</body>
</html>
